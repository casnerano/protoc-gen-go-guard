// Code generated by protoc-gen-go-guard. DO NOT EDIT.
// versions:
// - protoc-gen-go-guard {{ .Meta.PluginVersion }}
// - protoc             {{ .Meta.ProtocVersion }}
// source: {{ .File.Source }}

package {{ .File.Package }}

import (
    "github.com/casnerano/protoc-gen-go-guard/pkg/guard"
)

{{ define "guard-rule" -}}
{
    {{- if .AllowPublic }}
        AllowPublic: guard.Ptr({{ .AllowPublic }}),
    {{- else if .RequireAuthentication }}
        RequireAuthentication: guard.Ptr({{ .RequireAuthentication }}),
    {{- else if .AuthenticatedAccess }}
        AuthenticatedAccess: &guard.AuthenticatedAccess{
            {{- if .AuthenticatedAccess.RoleBased }}
                RoleBased: &guard.RoleBased{
                    Roles: []string{
                        {{- range .AuthenticatedAccess.RoleBased.Roles -}}
                            "{{ . | toLower }}",
                        {{- end -}}
                    },
                    Requirement: guard.Requirement({{ .AuthenticatedAccess.RoleBased.Requirement }}),
                },
            {{- end }}
            {{- if .AuthenticatedAccess.PolicyBased }}
            PolicyBased: &guard.PolicyBased{
                Policies: []string{
                    {{- range .AuthenticatedAccess.PolicyBased.Policies -}}
                        "{{ . }}",
                    {{- end -}}
                },
                Requirement: guard.Requirement({{ .AuthenticatedAccess.PolicyBased.Requirement }}),
            },
            {{- end }}
        },
    {{- end }}
}
{{- end }}

{{ define "guard-rules" -}}
    []*guard.Rule{
        {{- range . }}
            {{ template "guard-rule" . }},
        {{- end }}
    }
{{- end }}

{{- range .Services }}
    var guardService_{{ .Name }} = guard.Service{
        Name: "{{ .Name }}",
        {{- if .Rules }}
            Rules: {{ template "guard-rules" .Rules }},
        {{- end }}
        Methods: map[string]*guard.Method{
            {{- range $name, $method := .Methods }}
                "{{ $name }}": {
                    Rules: {{ template "guard-rules" $method.Rules }},
                },
            {{- end }}
        },
    }

    func (Unimplemented{{ .Name }}Server) GuardService() *guard.Service {
        return &guardService_{{ .Name }}
    }
{{- end }}